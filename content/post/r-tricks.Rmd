---
title: "Useful R tricks"
author: "Nick Griffiths"
date: 2020-02-17
draft: true
---

```{r setup,include = FALSE}
knitr::opts_chunk$set(collapse = TRUE, message = FALSE)
```

A list of useful tricks for doing data analysis in R.

```{r}
library(tidyverse)
```

### Split complex mutations into two steps

Say you want to calculate the sepal length in relation to the second shortest sepal. Rather than putting all that in one step, it's better to use two.

```{r}
iris %>%
  mutate(ord = rank(Sepal.Length, ties.method = "first")) %>%
  mutate(addl.Sepal.Length = Sepal.Length - Sepal.Length[ord == 2]) %>%
  select(Sepal.Length, ord, addl.Sepal.Length) %>%
  summary()
```

This is often helpful when you have to calculate some scalar value (here, `Sepal.Length[ord == 2]`). The goal is put all the details right into the pipeline, instead of breaking it off into a separate function.

### Assign IDs to group neighboring rows

Sometimes rows of a dataset form a group with their neighbors but do not have a field indicating this. The answer is `cumsum()`.

Source: [pivot vignette](https://tidyr.tidyverse.org/articles/pivot.html#contact-list) in tidyr

```{r}
library(tidyverse)

contacts <- tribble(
  ~field, ~value,
  "name", "Jiena McLellan",
  "company", "Toyota", 
  "name", "John Smith", 
  "company", "google", 
  "email", "john@google.com",
  "name", "Huxley Ratcliffe"
)

contacts <- contacts %>% 
  mutate(
    person_id = cumsum(field == "name")
  )

contacts
```

This can also be used to merge datasets when they do not have common fields but can be sorted into sequential groups.
