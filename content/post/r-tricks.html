---
title: "Useful R tricks"
author: "Nick Griffiths"
date: 2020-02-17
draft: true
categories: Programming
---

<script src="/rmarkdown-libs/header-attrs/header-attrs.js"></script>


<p>A list of useful tricks for doing data analysis in R.</p>
<pre class="r"><code>library(tidyverse)</code></pre>
<div id="split-complex-mutations-into-two-steps" class="section level3">
<h3>Split complex mutations into two steps</h3>
<p>Say you want to calculate the sepal length in relation to the second shortest sepal. Rather than putting all that in one step, itâ€™s better to use two.</p>
<pre class="r"><code>iris %&gt;%
  mutate(ord = rank(Sepal.Length, ties.method = &quot;first&quot;)) %&gt;%
  mutate(addl.Sepal.Length = Sepal.Length - Sepal.Length[ord == 2]) %&gt;%
  select(Sepal.Length, ord, addl.Sepal.Length) %&gt;%
  summary()
##   Sepal.Length        ord         addl.Sepal.Length
##  Min.   :4.300   Min.   :  1.00   Min.   :-0.100   
##  1st Qu.:5.100   1st Qu.: 38.25   1st Qu.: 0.700   
##  Median :5.800   Median : 75.50   Median : 1.400   
##  Mean   :5.843   Mean   : 75.50   Mean   : 1.443   
##  3rd Qu.:6.400   3rd Qu.:112.75   3rd Qu.: 2.000   
##  Max.   :7.900   Max.   :150.00   Max.   : 3.500</code></pre>
<p>This is often helpful when you have to calculate some scalar value (here, <code>Sepal.Length[ord == 2]</code>). The goal is put all the details right into the pipeline, instead of breaking it off into a separate function.</p>
</div>
<div id="assign-ids-to-group-neighboring-rows" class="section level3">
<h3>Assign IDs to group neighboring rows</h3>
<p>Sometimes rows of a dataset form a group with their neighbors but do not have a field indicating this. The answer is <code>cumsum()</code>.</p>
<p>Source: <a href="https://tidyr.tidyverse.org/articles/pivot.html#contact-list">pivot vignette</a> in tidyr</p>
<pre class="r"><code>library(tidyverse)

contacts &lt;- tribble(
  ~field, ~value,
  &quot;name&quot;, &quot;Jiena McLellan&quot;,
  &quot;company&quot;, &quot;Toyota&quot;, 
  &quot;name&quot;, &quot;John Smith&quot;, 
  &quot;company&quot;, &quot;google&quot;, 
  &quot;email&quot;, &quot;john@google.com&quot;,
  &quot;name&quot;, &quot;Huxley Ratcliffe&quot;
)

contacts &lt;- contacts %&gt;% 
  mutate(
    person_id = cumsum(field == &quot;name&quot;)
  )

contacts
## # A tibble: 6 x 3
##   field   value            person_id
##   &lt;chr&gt;   &lt;chr&gt;                &lt;int&gt;
## 1 name    Jiena McLellan           1
## 2 company Toyota                   1
## 3 name    John Smith               2
## 4 company google                   2
## 5 email   john@google.com          2
## 6 name    Huxley Ratcliffe         3</code></pre>
<p>This can also be used to merge datasets when they do not have common fields but can be sorted into sequential groups.</p>
</div>
